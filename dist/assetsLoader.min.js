!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).assetsLoader=t()}(this,function(){"use strict";function e(){}function t(){t.init.call(this)}function n(e){return void 0===e._maxListeners?t.defaultMaxListeners:e._maxListeners}function r(e,t,n){if(t)e.call(n);else for(var r=e.length,i=l(e,r),o=0;o<r;++o)i[o].call(n)}function i(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,o=l(e,i),s=0;s<i;++s)o[s].call(n,r)}function o(e,t,n,r,i){if(t)e.call(n,r,i);else for(var o=e.length,s=l(e,o),u=0;u<o;++u)s[u].call(n,r,i)}function s(e,t,n,r,i,o){if(t)e.call(n,r,i,o);else for(var s=e.length,u=l(e,s),f=0;f<s;++f)u[f].call(n,r,i,o)}function u(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,o=l(e,i),s=0;s<i;++s)o[s].apply(n,r)}function f(t,r,i,o){var s,u,f,a;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((u=t._events)?(u.newListener&&(t.emit("newListener",r,i.listener?i.listener:i),u=t._events),f=u[r]):(u=t._events=new e,t._eventsCount=0),f){if("function"==typeof f?f=u[r]=o?[i,f]:[f,i]:o?f.unshift(i):f.push(i),!f.warned&&(s=n(t))&&s>0&&f.length>s){f.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+r+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=r,c.count=f.length,a=c,"function"==typeof console.warn?console.warn(a):console.log(a)}}else f=u[r]=i,++t._eventsCount;return t}function a(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function c(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function l(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}e.prototype=Object.create(null),t.EventEmitter=t,t.usingDomains=!1,t.prototype.domain=void 0,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.init=function(){this.domain=null,t.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new e,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},t.prototype.getMaxListeners=function(){return n(this)},t.prototype.emit=function(e){var t,n,f,a,c,l,h,p="error"===e;if(l=this._events)p=p&&null==l.error;else if(!p)return!1;if(h=this.domain,p){if(t=arguments[1],!h){if(t instanceof Error)throw t;var v=new Error('Uncaught, unspecified "error" event. ('+t+")");throw v.context=t,v}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=h,t.domainThrown=!1,h.emit("error",t),!1}if(!(n=l[e]))return!1;var m="function"==typeof n;switch(f=arguments.length){case 1:r(n,m,this);break;case 2:i(n,m,this,arguments[1]);break;case 3:o(n,m,this,arguments[1],arguments[2]);break;case 4:s(n,m,this,arguments[1],arguments[2],arguments[3]);break;default:for(a=new Array(f-1),c=1;c<f;c++)a[c-1]=arguments[c];u(n,m,this,a)}return!0},t.prototype.addListener=function(e,t){return f(this,e,t,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(e,t){return f(this,e,t,!0)},t.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,a(this,e,t)),this},t.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,a(this,e,t)),this},t.prototype.removeListener=function(t,n){var r,i,o,s,u;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[t]))return this;if(r===n||r.listener&&r.listener===n)0==--this._eventsCount?this._events=new e:(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if("function"!=typeof r){for(o=-1,s=r.length;s-- >0;)if(r[s]===n||r[s].listener&&r[s].listener===n){u=r[s].listener,o=s;break}if(o<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new e,this;delete i[t]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(r,o);i.removeListener&&this.emit("removeListener",t,u||n)}return this},t.prototype.removeAllListeners=function(t){var n,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new e,this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=new e:delete r[t]),this;if(0===arguments.length){for(var i,o=Object.keys(r),s=0;s<o.length;++s)"removeListener"!==(i=o[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new e,this._eventsCount=0,this}if("function"==typeof(n=r[t]))this.removeListener(t,n);else if(n)do{this.removeListener(t,n[n.length-1])}while(n[0]);return this},t.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},t.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):c.call(e,t)},t.prototype.listenerCount=c,t.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var h={image:["png","jpg","jpge","gif","svg","webp"]};return function(e,n){void 0===e&&(e=[]),void 0===n&&(n={});var r,i,o,s,u=0,f=0,a=[],c=new t,l=n.delay,p=n.effect||function(){};Array.isArray(l)&&(r=l[0],i=l[1],o=i-r,s=Math.random(),f=r+Math.round(s*o));var v=e.length+f;return c.on("load",function(){var e=(u+1)/v*100;u++,p(e)}),a.push.apply(a,e.map(function(e){switch(function(e){var t="unknow",n=/^(https:|http:)?\/\/[\w+\.\/]+\.(\w+)$/.exec(e);if(n)for(var r in h)h[r].includes(n[2].toLowerCase())&&(t=r);return t}(e)){case"image":return function(e,t){return void 0===t&&(t={}),new Promise(function(n){var r=new Image;r.onload=function(){t.success&&t.success(),n("[image] "+e)},r.onerror=function(e){t.error&&t.error(e)},r.src=e})}(e,{success:function(){return c.emit("load")}});case"unknow":return function(e,t){return void 0===t&&(t={}),new Promise(function(n){t.success&&t.success(),n("[unknow] "+e)})}(e,{success:function(){console.warn("Assets Loader: unknow asset type "+e),c.emit("load")}})}})),a.push.apply(a,function(e,t){return void 0===e&&(e=0),void 0===t&&(t={}),new Array(e).fill("delay").map(function(e,n){return new Promise(function(e){setTimeout(function(){t.done&&t.done(),e("[delay] "+(n+1))},1e3*Math.random())})})}(f,{done:function(){return c.emit("load")}})),a}});
